{%load static%}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <link rel="stylesheet" href='{% static "css/groupcalendar.css" %}' />
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;400;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <title>Document</title>
    <script>
      function go_prev_month() {
        location.href = "{%url 'groupCalendar_view' groupId%}?{{prev_month}}";
      }
      function go_next_month() {
        location.href = "{%url 'groupCalendar_view' groupId%}?{{next_month}}";
      }
      function view_day_schedule(self) {
        var url_str = "{%url 'groupCalendar_view' groupId%}?{{cur_month}}&day=" + self.innerText;
        location.href = url_str;
      }
    </script>

    <style>
      .table-content th {
        width: 35%;
      }
    </style>
  </head>
  <body>
    <div class="main-section">
      <div class="left-section">
        <h3>Group Schedule</h3>
        {{calendar}}
        <div class="calendar-info">
          <div class="empty-box">&nbsp;</div>
          &nbsp;: 스케줄 있음
        </div>
      </div>

      <div class="right-section">
        <br />

        <div class="table-title">
          <span class="group-name">Group Time-table</span>
        </div>
        
        {%if date%}
          {{date.0}}년 {{date.1}}월 {{date.2}}일<br>
        {%endif%}
        <div class="table-section">
          <div class="table-content">
            <table class="time-table">
              <tbody>
               {% for time , value in schedule_list.items %}
                <tr>
                  <th rowspan="2">{{time}}</th>
                  {% if value.0 == 1 %}
                    <td style="background-color: #eee;"></td>
                  {% else %}
                    <td id="selectTime" data-bs-toggle="modal" data-bs-target="#exampleModal" data-hour="{{time}}" data-minute="00"></td>
                  {% endif %}
                </tr>
                <tr>
                  {% if value.1 == 1 %}
                    <td style="background-color: #eee;"></td>
                  {% else %}
                    <td id="selectTime" data-bs-toggle="modal" data-bs-target="#exampleModal" data-hour="{{time}}" data-minute="30"></td>
                  {% endif %}
                </tr>
                {% endfor %}
                
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">그룹 일정 추가</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="">
              일정 시작: 
              <select name="start_year" id="start_year" disabled>
                <option value="{{date.0}}" selected>{{date.0}}</option>
              </select>년
              <select name="start_month" id="start_month" disabled>
                <option value="{{date.1}}" selected>{{date.1}}</option>
              </select>월
              <select name="start_day" id="start_day" disabled>
                <option value="{{date.2}}" selected>{{date.2}}</option>
              </select>일
              <select name="start_hour" id="start_hour" value="" disabled>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
              </select>시
              <select name="start_minute" id="start_minute" value="" disabled>
                <option value="00">00</option>
                <option value="30">30</option>
              </select>분
              <br/><br/>
              일정 끝: 
              <input type="date" name="start_date" id="start_date" value="{{date.0}}-{{date.1}}-{{date.2}}" min="{{date.0}}-{{date.1}}-{{date.2}}" max="{{date.0|add:'1'}}-{{date.1}}-{{date.2}}">
              <select name="end_hour" id="end_hour" >
                <option value=""></option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
              </select>시
              <select name="end_minute" id="end_minute" >
                <option value=""></option>
                <option value="00">00</option>
                <option value="30">30</option>
              </select>분
              <br/><br/>
            일정명: <input type="select" name="title" id="title" />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      $(document).on('click', '#selectTime', function () {
        var selectedHour = $(this).data('hour')
        var selectedMinute = $(this).data('minute')
        $('.modal-body #start_hour').val(selectedHour);
        $('.modal-body #start_minute').val(selectedMinute);
      });
    </script>
  </body>
</html>
